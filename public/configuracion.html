<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configuraci√≥n ‚Äî Las Gambusinas</title>
  <!-- Animate.css - Animaciones CSS puras -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <!-- AOS - Animate On Scroll -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.3/dist/cdn.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        bg: { primary: '#0a0a0f', card: '#1a1a28', sidebar: '#12121a' },
        gold: { DEFAULT: '#d4af37', '20': 'rgba(212,175,55,0.125)', '40': 'rgba(212,175,55,0.25)' },
        st: { libre: '#00d4aa', esperando: '#ffa502', pedido: '#3498db', preparado: '#2ecc71', pagado: '#ff4757', reservado: '#5352ed' },
        txt: { primary: '#ffffff', secondary: '#a0a0b8', muted: '#5a5a7a' }
      },
      fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] }
    }
  }
}
</script>
<link rel="stylesheet" href="/assets/css/dashboard.css">
<link rel="stylesheet" href="/assets/css/animations.css">
</head>
<body class="bg-bg-primary text-white font-sans antialiased min-h-screen" x-data="configApp()" x-cloak>

<div id="topbar-container"></div>
<div class="flex pt-[72px] min-h-screen">
  <div id="sidebar-container"></div>
  <main :class="sidebarOpen ? 'ml-[270px]' : 'ml-[68px]'" class="flex-1 transition-all duration-300 min-h-[calc(100vh-72px)] p-6">
    
    <!-- HEADER -->
    <div class="flex items-center justify-between mb-5">
      <h1 class="text-xl font-bold">Configuraci√≥n del Sistema</h1>
      <div class="flex gap-2">
        <button @click="loadConfig()" class="px-4 py-2 border border-txt-muted/30 rounded-lg text-sm text-txt-secondary hover:border-gold hover:text-gold transition">üîÑ Actualizar</button>
        <button @click="guardarConfig()" class="bg-gold text-bg-primary px-5 py-2 rounded-lg text-sm font-semibold hover:brightness-110 transition" :disabled="saving">
          <span x-show="!saving">üíæ Guardar Cambios</span>
          <span x-show="saving" class="flex items-center gap-2">
            <span class="w-4 h-4 border-2 border-bg-primary border-t-transparent rounded-full animate-spin"></span>
            Guardando...
          </span>
        </button>
      </div>
    </div>

    <!-- LOADING STATE -->
    <div x-show="loading" class="flex items-center justify-center h-64">
      <div class="w-8 h-8 border-2 border-gold border-t-transparent rounded-full animate-spin"></div>
    </div>

    <div x-show="!loading" class="flex gap-5">
      <!-- VERTICAL TABS -->
      <div class="w-[200px] space-y-1 flex-shrink-0">
        <template x-for="t in tabs" :key="t.id">
          <button @click="cfgTab=t.id" :class="cfgTab===t.id ? 'bg-gold-20 text-gold border-l-[3px] border-gold' : 'text-txt-secondary hover:bg-gold-20/50 border-l-[3px] border-transparent'"
            class="w-full text-left px-4 py-2.5 text-sm rounded-r-lg transition flex items-center gap-2">
            <span x-text="t.icon"></span>
            <span x-text="t.label"></span>
          </button>
        </template>
      </div>

      <!-- CONTENT -->
      <div class="flex-1 bg-bg-card border border-[rgba(212,175,55,0.15)] rounded-xl overflow-hidden">
        
        <!-- GENERAL -->
        <div x-show="cfgTab==='general'" class="p-6 space-y-6">
          <div>
            <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Informaci√≥n del Restaurante</h3>
            <div class="space-y-4">
              <div>
                <label class="text-xs text-txt-secondary mb-1 block">Nombre del restaurante</label>
                <input type="text" x-model="config.nombre" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="text-xs text-txt-secondary mb-1 block">Direcci√≥n</label>
                  <input type="text" x-model="config.direccion" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
                </div>
                <div>
                  <label class="text-xs text-txt-secondary mb-1 block">Tel√©fono</label>
                  <input type="text" x-model="config.telefono" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="text-xs text-txt-secondary mb-1 block">Email</label>
                  <input type="email" x-model="config.email" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
                </div>
                <div>
                  <label class="text-xs text-txt-secondary mb-1 block">RUC</label>
                  <input type="text" x-model="config.ruc" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
                </div>
              </div>
            </div>
          </div>
          <div class="border-t border-[rgba(212,175,55,0.15)] pt-6">
            <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Horarios de Operaci√≥n</h3>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-xs text-txt-secondary mb-1 block">Hora de apertura</label>
                <input type="time" x-model="config.horaApertura" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
              </div>
              <div>
                <label class="text-xs text-txt-secondary mb-1 block">Hora de cierre</label>
                <input type="time" x-model="config.horaCierre" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
              </div>
            </div>
          </div>
          <div class="border-t border-[rgba(212,175,55,0.15)] pt-6">
            <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Preferencias</h3>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-xs text-txt-secondary mb-1 block">Zona horaria</label>
                <select x-model="config.zonaHoraria" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm text-txt-secondary focus:border-gold focus:outline-none">
                  <option value="America/Lima">America/Lima</option>
                  <option value="America/New_York">America/New_York</option>
                  <option value="Europe/Madrid">Europe/Madrid</option>
                </select>
              </div>
              <div>
                <label class="text-xs text-txt-secondary mb-1 block">Idioma</label>
                <select x-model="config.idioma" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm text-txt-secondary focus:border-gold focus:outline-none">
                  <option value="es">Espa√±ol</option>
                  <option value="en">English</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- MONEDA Y PRECIOS -->
        <div x-show="cfgTab==='moneda'" class="p-6 space-y-6">
          <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Moneda y Precios</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Moneda</label>
              <select x-model="config.moneda" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm text-txt-secondary focus:border-gold focus:outline-none">
                <option value="PEN">Soles (PEN)</option>
                <option value="USD">D√≥lares (USD)</option>
                <option value="EUR">Euros (EUR)</option>
              </select>
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">S√≠mbolo</label>
              <input type="text" x-model="config.simboloMoneda" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Decimales</label>
              <select x-model="config.decimales" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm text-txt-secondary focus:border-gold focus:outline-none">
                <option value="2">2 decimales</option>
                <option value="0">Sin decimales</option>
              </select>
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">IGV (%)</label>
              <input type="number" x-model="config.igvPorcentaje" step="0.01" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
          </div>
          <label class="flex items-center gap-3 cursor-pointer">
            <input type="checkbox" x-model="config.igvIncluido" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
            <span class="text-sm text-txt-secondary">Precios ya incluyen IGV</span>
          </label>
        </div>

        <!-- MESAS Y √ÅREAS -->
        <div x-show="cfgTab==='mesas'" class="p-6 space-y-6">
          <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Mesas y √Åreas</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Alerta de espera (min)</label>
              <input type="number" x-model="config.alertaEsperaMin" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Auto liberaci√≥n (min, 0=desactivado)</label>
              <input type="number" x-model="config.autoLiberacionMin" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Duraci√≥n m√°xima reserva (horas)</label>
              <input type="number" x-model="config.duracionMaxReserva" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Capacidad por defecto</label>
              <input type="number" x-model="config.capacidadPorDefecto" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
          </div>
          <label class="flex items-center gap-3 cursor-pointer">
            <input type="checkbox" x-model="config.permitirReservas" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
            <span class="text-sm text-txt-secondary">Permitir reservas</span>
          </label>
        </div>

        <!-- COCINA -->
        <div x-show="cfgTab==='cocina'" class="p-6 space-y-6">
          <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Cocina</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Alerta amarilla (min)</label>
              <input type="number" x-model="config.alertaAmarillaMin" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Alerta roja (min)</label>
              <input type="number" x-model="config.alertaRojaMin" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Volumen notificaciones (%)</label>
              <input type="number" x-model="config.volumenNotif" min="0" max="100" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Impresora por defecto</label>
              <input type="text" x-model="config.impresoraDefault" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
          </div>
          <div class="space-y-3">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.sonidoNotif" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Sonido de notificaciones</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.autoImpresion" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Auto impresi√≥n de comandas</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.mostrarComplementos" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Mostrar complementos en tickets</span>
            </label>
          </div>
        </div>

        <!-- PAGOS -->
        <div x-show="cfgTab==='pagos'" class="p-6 space-y-6">
          <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Pagos y Facturaci√≥n</h3>
          <div>
            <label class="text-xs text-txt-secondary mb-2 block">M√©todos de pago habilitados</label>
            <div class="grid grid-cols-2 gap-2">
              <label class="flex items-center gap-2 cursor-pointer bg-bg-sidebar p-3 rounded-lg">
                <input type="checkbox" x-model="config.metodoEfectivo" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-primary text-gold focus:ring-gold">
                <span class="text-sm">üíµ Efectivo</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer bg-bg-sidebar p-3 rounded-lg">
                <input type="checkbox" x-model="config.metodoTarjeta" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-primary text-gold focus:ring-gold">
                <span class="text-sm">üí≥ Tarjeta</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer bg-bg-sidebar p-3 rounded-lg">
                <input type="checkbox" x-model="config.metodoYape" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-primary text-gold focus:ring-gold">
                <span class="text-sm">üì± Yape/Plin</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer bg-bg-sidebar p-3 rounded-lg">
                <input type="checkbox" x-model="config.metodoTransferencia" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-primary text-gold focus:ring-gold">
                <span class="text-sm">üè¶ Transferencia</span>
              </label>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Propina sugerida (%)</label>
              <input type="number" x-model="config.propinaSugeridaPct" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Descuento m√°ximo (%)</label>
              <input type="number" x-model="config.descuentoMaxPct" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Prefijo de voucher</label>
              <input type="text" x-model="config.prefijoVoucher" placeholder="BCH-001" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Serie comprobantes</label>
              <input type="text" x-model="config.serieComprobantes" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
          </div>
          <div class="space-y-3">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.propinasHabilitadas" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Propinas habilitadas</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.descuentosHabilitados" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Descuentos habilitados</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.numeracionAuto" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Numeraci√≥n autom√°tica de comprobantes</span>
            </label>
          </div>
        </div>

        <!-- NOTIFICACIONES -->
        <div x-show="cfgTab==='notificaciones'" class="p-6 space-y-6">
          <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Notificaciones</h3>
          <div class="space-y-3">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.pushHabilitado" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Notificaciones push</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.emailAlertas" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Alertas por email</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.notifNuevasComandas" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Notificar nuevas comandas</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.notifComandasListas" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Notificar comandas listas</span>
            </label>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Alerta mesa abandonada (min)</label>
              <input type="number" x-model="config.alertaMesaAbandonada" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Stock m√≠nimo alerta</label>
              <input type="number" x-model="config.stockMinimoAlerta" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
          </div>
          <label class="flex items-center gap-3 cursor-pointer">
            <input type="checkbox" x-model="config.stockBajoAlerta" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
            <span class="text-sm text-txt-secondary">Alertar stock bajo</span>
          </label>
        </div>

        <!-- CIERRE DE CAJA -->
        <div x-show="cfgTab==='cierre'" class="p-6 space-y-6">
          <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Cierre de Caja</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Hora cierre autom√°tico</label>
              <input type="time" x-model="config.horaCierreAuto" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Email reportes</label>
              <input type="email" x-model="config.emailReportes" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
          </div>
          <div class="space-y-3">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.cierreAutomatico" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Cierre autom√°tico diario</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.validacionAdmin" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Requiere validaci√≥n de admin</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.exportAutoPdf" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Exportar PDF autom√°ticamente</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.exportAutoExcel" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Exportar Excel autom√°ticamente</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.desgloseComplementos" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Desglose de complementos</span>
            </label>
          </div>
        </div>

        <!-- SEGURIDAD -->
        <div x-show="cfgTab==='seguridad'" class="p-6 space-y-6">
          <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Seguridad</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Timeout inactividad (min)</label>
              <input type="number" x-model="config.timeoutInactividadMin" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Sesiones simult√°neas</label>
              <select x-model="config.sesionesSimultaneas" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm text-txt-secondary focus:border-gold focus:outline-none">
                <option value="1">Una sesi√≥n</option>
                <option value="3">Hasta 3</option>
                <option value="0">Sin l√≠mite</option>
              </select>
            </div>
          </div>
          <div>
            <label class="text-xs text-txt-secondary mb-1 block">IPs permitidas (una por l√≠nea, vac√≠o = todas)</label>
            <textarea x-model="config.ipPermitidas" placeholder="192.168.1.100&#10;192.168.1.101" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm h-24 resize-none focus:border-gold focus:outline-none font-mono"></textarea>
          </div>
          <div class="space-y-3">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.requiere2fa" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Requiere autenticaci√≥n de dos factores</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.auditoriaExtendida" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Auditor√≠a extendida</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.logsDetallados" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Logs detallados</span>
            </label>
          </div>
        </div>

        <!-- INTEGRACIONES -->
        <div x-show="cfgTab==='integraciones'" class="p-6 space-y-6">
          <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Integraciones</h3>
          <div class="space-y-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Endpoint API externo</label>
              <input type="url" x-model="config.endpointApiExterno" placeholder="https://api.example.com" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none font-mono">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Webhook comandas</label>
              <input type="url" x-model="config.webhookComandas" placeholder="https://hooks.example.com/comandas" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none font-mono">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Token de integraci√≥n</label>
              <input type="text" x-model="config.tokenIntegracion" class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm focus:border-gold focus:outline-none font-mono">
            </div>
          </div>
          <div class="space-y-3">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.socketioActivo" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Socket.io activo</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.redisActivo" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Redis cache activo</span>
            </label>
          </div>
        </div>

        <!-- AVANZADO -->
        <div x-show="cfgTab==='avanzado'" class="p-6 space-y-6">
          <h3 class="text-sm font-semibold text-txt-secondary uppercase mb-4">Configuraci√≥n Avanzada</h3>
          <div class="bg-st-pagado/10 border border-st-pagado/30 rounded-lg p-4 mb-4">
            <p class="text-xs text-st-pagado">‚ö†Ô∏è Estas configuraciones son avanzadas. Modificarlas puede afectar el funcionamiento del sistema.</p>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">Versi√≥n del sistema</label>
              <input type="text" x-model="config.versionSistema" readonly class="w-full bg-bg-primary border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm text-txt-muted">
            </div>
            <div>
              <label class="text-xs text-txt-secondary mb-1 block">√öltima actualizaci√≥n</label>
              <input type="text" :value="config.fechaActualizacion ? new Date(config.fechaActualizacion).toLocaleString('es-PE') : '‚Äî'" readonly class="w-full bg-bg-primary border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm text-txt-muted">
            </div>
          </div>
          <div>
            <label class="text-xs text-txt-secondary mb-1 block">Mensaje de mantenimiento</label>
            <textarea x-model="config.mensajeMantenimiento" placeholder="El sistema est√° en mantenimiento..." class="w-full bg-bg-sidebar border border-[rgba(212,175,55,0.25)] rounded-lg px-4 py-2.5 text-sm h-20 resize-none focus:border-gold focus:outline-none"></textarea>
          </div>
          <div class="space-y-3">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.modoMantenimiento" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Modo mantenimiento</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" x-model="config.syncJsonLegacy" class="w-4 h-4 rounded border-[rgba(212,175,55,0.25)] bg-bg-sidebar text-gold focus:ring-gold">
              <span class="text-sm text-txt-secondary">Sincronizar con JSON legacy</span>
            </label>
          </div>
        </div>

      </div>
    </div>

  </main>
</div>

<!-- TOAST CONTAINER -->
<div id="toast-container" class="fixed bottom-6 right-6 z-[9999] space-y-2"></div>

<script src="/assets/js/shared.js"></script>
<script>
function configApp() {
  return {
    sidebarOpen: true,
    loading: true,
    saving: false,
    cfgTab: 'general',
    activeNav: 'config',
    pageTitle: 'Configuraci√≥n',
    
    tabs: [
      { id: 'general', label: 'General', icon: '‚öôÔ∏è' },
      { id: 'moneda', label: 'Moneda y Precios', icon: 'üí∞' },
      { id: 'mesas', label: 'Mesas y √Åreas', icon: 'ü™ë' },
      { id: 'cocina', label: 'Cocina', icon: 'üç≥' },
      { id: 'pagos', label: 'Pagos', icon: 'üí≥' },
      { id: 'notificaciones', label: 'Notificaciones', icon: 'üîî' },
      { id: 'cierre', label: 'Cierre de Caja', icon: 'üìä' },
      { id: 'seguridad', label: 'Seguridad', icon: 'üîí' },
      { id: 'integraciones', label: 'Integraciones', icon: 'üîó' },
      { id: 'avanzado', label: 'Avanzado', icon: 'üõ†Ô∏è' }
    ],
    
    config: {
      // General
      nombre: 'Las Gambusinas',
      direccion: '',
      telefono: '',
      email: '',
      ruc: '',
      horaApertura: '08:00',
      horaCierre: '23:00',
      zonaHoraria: 'America/Lima',
      idioma: 'es',
      // Moneda
      moneda: 'PEN',
      simboloMoneda: 'S/.',
      decimales: 2,
      igvPorcentaje: 18,
      igvIncluido: false,
      // Mesas
      alertaEsperaMin: 15,
      autoLiberacionMin: 0,
      permitirReservas: true,
      duracionMaxReserva: 2,
      capacidadPorDefecto: 4,
      // Cocina
      alertaAmarillaMin: 10,
      alertaRojaMin: 20,
      sonidoNotif: true,
      volumenNotif: 80,
      autoImpresion: false,
      impresoraDefault: '',
      mostrarComplementos: true,
      // Pagos
      metodoEfectivo: true,
      metodoTarjeta: true,
      metodoYape: true,
      metodoTransferencia: false,
      propinasHabilitadas: true,
      propinaSugeridaPct: 10,
      descuentosHabilitados: true,
      descuentoMaxPct: 15,
      prefijoVoucher: 'BCH-001',
      numeracionAuto: true,
      serieComprobantes: '',
      // Notificaciones
      pushHabilitado: true,
      emailAlertas: false,
      alertaMesaAbandonada: 30,
      stockBajoAlerta: true,
      stockMinimoAlerta: 5,
      notifNuevasComandas: true,
      notifComandasListas: true,
      // Cierre de Caja
      cierreAutomatico: false,
      horaCierreAuto: '23:59',
      validacionAdmin: true,
      exportAutoPdf: false,
      exportAutoExcel: false,
      emailReportes: '',
      desgloseComplementos: true,
      // Seguridad
      sesionesSimultaneas: '3',
      timeoutInactividadMin: 30,
      requiere2fa: false,
      auditoriaExtendida: true,
      logsDetallados: false,
      ipPermitidas: '',
      // Integraciones
      socketioActivo: true,
      redisActivo: true,
      endpointApiExterno: '',
      webhookComandas: '',
      tokenIntegracion: '',
      // Avanzado
      modoMantenimiento: false,
      mensajeMantenimiento: '',
      syncJsonLegacy: false,
      versionSistema: '2.0.0',
      fechaActualizacion: null
    },
    
    async init() {
      const token = localStorage.getItem('adminToken') || sessionStorage.getItem('adminToken');
      if (!token) {
        window.location.href = '/login.html';
        return;
      }
      await this.loadConfig();
    },
    
    async loadConfig() {
      this.loading = true;
      
      try {
        const data = await apiGet('/configuracion');
        if (data && !data.error) {
          // Mapear la respuesta de la API al objeto config
          const cfg = data.configuracion || data;
          this.config = {
            ...this.config,
            ...cfg,
            // Asegurar valores por defecto para campos que puedan venir null
            nombre: cfg.nombre || 'Las Gambusinas',
            moneda: cfg.moneda || 'PEN',
            simboloMoneda: cfg.simboloMoneda || 'S/.',
            igvPorcentaje: cfg.igvPorcentaje ?? 18,
            decimales: cfg.decimales ?? 2,
          };
        }
      } catch (e) {
        console.error('Error cargando configuraci√≥n:', e);
        // Si hay error, mantener valores por defecto
      }
      
      this.loading = false;
    },
    
    async guardarConfig() {
      this.saving = true;
      
      try {
        const res = await apiPut('/configuracion', this.config);
        if (res && !res.error) {
          this.showToast('Configuraci√≥n guardada exitosamente ‚úÖ');
          // Recargar para confirmar
          await this.loadConfig();
        } else {
          this.showToast('Error al guardar: ' + (res?.error || res?.message || 'Fallo desconocido'), 'error');
        }
      } catch (e) {
        console.error('Error guardando configuraci√≥n:', e);
        this.showToast('Error de conexi√≥n al guardar', 'error');
      }
      
      this.saving = false;
    },
    
    showToast(msg, type = 'success') {
      const container = document.getElementById('toast-container');
      if (!container) return;
      const t = document.createElement('div');
      t.className = 'px-4 py-3 rounded-xl text-sm font-medium shadow-xl ' +
        (type === 'error' ? 'bg-st-pagado text-white' : 'bg-st-preparado text-white');
      t.textContent = msg;
      container.appendChild(t);
      setTimeout(() => t.remove(), 4000);
    },
    
    logout() {
      localStorage.removeItem('adminToken');
      window.location.href = '/login';
    }
  };
}
</script>
</body>
</html>
