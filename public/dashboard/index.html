<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Las Gambusinas - Dashboard Premium</title>
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="/dashboard/assets/images/favicon.ico" />
    
    <!-- Bootstrap 4 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- Line Awesome -->
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/dashboard/assets/css/dashboard-premium.css">
    <link rel="stylesheet" href="/dashboard/assets/css/header-premium.css">
    
    <!-- Script cr√≠tico: Funciones globales INMEDIATAS -->
    <script>
        // Ocultar loader ANTES de que cargue cualquier cosa
        (function() {
            const loader = document.getElementById('loading');
            if (loader) {
                loader.style.display = 'none';
                loader.style.visibility = 'hidden';
                loader.style.opacity = '0';
                loader.classList.add('loaded');
            }
        })();
        
        // FUNCI√ìN LOGOUT GLOBAL - Disponible INMEDIATAMENTE
        window.logout = function() {
            console.log('üö™ LOGOUT EJECUTADO');
            try {
                localStorage.removeItem('adminToken');
                localStorage.removeItem('theme');
                window.location.href = '/dashboard/login.html';
            } catch(e) {
                window.location.href = '/dashboard/login.html';
            }
        };
        
        window.cerrarSesion = window.logout;
        
        // FUNCI√ìN TOGGLE DROPDOWN - Disponible INMEDIATAMENTE
        window.toggleDropdown = function(tipo) {
            const dropdowns = {
                'notificaciones': 'dropdownNotifications',
                'mensajes': 'dropdownMessages',
                'usuario': 'dropdownUser'
            };
            
            const toggleId = dropdowns[tipo];
            if (!toggleId) return;
            
            const toggleEl = document.getElementById(toggleId);
            if (!toggleEl) return;
            
            let menuEl = toggleEl.nextElementSibling;
            if (!menuEl || !menuEl.classList.contains('dropdown-menu')) {
                const parentLi = toggleEl.closest('li');
                if (parentLi) {
                    menuEl = parentLi.querySelector('.dropdown-menu');
                }
            }
            
            if (!menuEl) return;
            
            const isOpen = menuEl.classList.contains('show');
            
            // Cerrar todos
            document.querySelectorAll('.dropdown-menu').forEach(m => {
                if (m !== menuEl) m.classList.remove('show');
            });
            
            // Toggle actual
            if (isOpen) {
                menuEl.classList.remove('show');
            } else {
                menuEl.classList.add('show');
            }
        };
        
        // FUNCI√ìN TOGGLE MODO - Disponible INMEDIATAMENTE
        window.toggleModo = function() {
            const isDark = document.body.classList.contains('theme-dark') || !document.body.classList.contains('theme-light');
            if (isDark) {
                document.body.classList.remove('theme-dark');
                document.body.classList.add('theme-light');
                localStorage.setItem('theme', 'light');
                const icon = document.getElementById('modoIcon');
                if (icon) icon.className = 'las la-sun';
            } else {
                document.body.classList.remove('theme-light');
                document.body.classList.add('theme-dark');
                localStorage.setItem('theme', 'dark');
                const icon = document.getElementById('modoIcon');
                if (icon) icon.className = 'las la-moon';
            }
        };
        
        console.log('‚úÖ Funciones globales registradas');
    </script>
</head>
<body class="dashboard-premium" onload="document.getElementById('loading') && (document.getElementById('loading').style.display = 'none')">
    <!-- Loader SVG Aprycot -->
    <div id="loading">
        <div class="loader simple-loader">
            <svg width="257" height="76" viewBox="0 0 257 76" fill="none" xmlns="http://www.w3.org/2000/svg">
                <ellipse cx="128.307" cy="41.9999" rx="54.3134" ry="25.4594" fill="white"/>
                <ellipse cx="128.307" cy="41.9999" rx="54.3134" ry="25.4594" fill="#d4af37" fill-opacity="0.32"/>
                <g class="anim_rotate" filter="url(#filter0_d)">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M174.417 33.1364C181.15 30.4429 188.725 33.7066 191.339 40.4108C193.953 47.1347 190.612 54.763 183.892 57.4565C177.159 60.15 168.985 57.0829 166.231 49.8282C163.451 42.5735 167.684 35.8299 174.417 33.1364Z" fill="#B9592C"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M173.983 31.7009C180.83 28.9681 188.532 32.2711 191.198 39.1129C193.863 45.9351 190.458 53.701 183.61 56.4535C176.763 59.1863 169.061 55.8834 166.396 49.0415C163.743 42.1996 167.135 34.4337 173.983 31.7009Z" fill="#FEBD30"/>
                </g>
                <defs>
                    <filter id="filter0_d" x="0" y="0" width="257" height="76" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>
                        <feOffset/>
                        <feGaussianBlur stdDeviation="2"/>
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
                        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
                        <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
                    </filter>
                </defs>
            </svg>
        </div>
    </div>
    
    <!-- Wrapper Start -->
    <div class="wrapper">
        <!-- Sidebar -->
        <div class="iq-sidebar sidebar-premium">
            <div class="iq-sidebar-logo d-flex align-items-center justify-content-between">
                <a href="/dashboard" class="header-logo">
                    <h5 class="logo-title ml-3">üçΩÔ∏è Las Gambusinas</h5>
                </a>
                <div class="iq-menu-bt-sidebar ml-0">
                    <i class="las la-bars wrapper-menu"></i>
                </div>
            </div>
            <div class="sidebar-user-info p-3 border-top border-bottom" style="border-color: rgba(212, 175, 55, 0.2) !important;">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <small class="text-muted d-block">Usuario</small>
                        <span id="sidebar-username" class="text-gold">Admin</span>
                    </div>
                    <button class="btn btn-sm btn-outline-gold" onclick="logout()" title="Cerrar sesi√≥n">
                        <i class="las la-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            <div class="data-scrollbar" data-scroll="1">
                <nav class="iq-sidebar-menu">
                    <ul id="iq-sidebar-toggle" class="iq-menu">
                        <li class="active">
                            <a href="/dashboard" class="svg-icon">
                                <i class="las la-home"></i>
                                <span class="ml-4">Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="/dashboard/pages/mesas.html">
                                <i class="las la-clipboard-list"></i>
                                <span class="ml-4">Mesas</span>
                            </a>
                        </li>
                        <li>
                            <a href="/dashboard/pages/areas.html">
                                <i class="las la-map-marked-alt"></i>
                                <span class="ml-4">√Åreas</span>
                            </a>
                        </li>
                        <li>
                            <a href="/dashboard/pages/mozos.html">
                                <i class="las la-users"></i>
                                <span class="ml-4">Mozos</span>
                            </a>
                        </li>
                        <li>
                            <a href="/dashboard/pages/platos.html">
                                <i class="las la-utensils"></i>
                                <span class="ml-4">Platos</span>
                            </a>
                        </li>
                        <li>
                            <a href="/dashboard/pages/comandas.html">
                                <i class="las la-file-invoice"></i>
                                <span class="ml-4">Comandas</span>
                            </a>
                        </li>
                        <li>
                            <a href="/dashboard/pages/bouchers.html">
                                <i class="las la-receipt"></i>
                                <span class="ml-4">Bouchers</span>
                            </a>
                        </li>
                        <li>
                            <a href="/dashboard/pages/clientes.html">
                                <i class="las la-user-friends"></i>
                                <span class="ml-4">Clientes</span>
                            </a>
                        </li>
                        <li>
                            <a href="/dashboard/pages/auditoria.html">
                                <i class="las la-search"></i>
                                <span class="ml-4">Auditor√≠a</span>
                            </a>
                        </li>
                        <li>
                            <a href="/dashboard/pages/cierre-caja.html">
                                <i class="las la-cash-register"></i>
                                <span class="ml-4">Cierre Caja</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        
        <!-- Top Navbar Start -->
        <div class="iq-top-navbar">
            <div class="iq-navbar-custom">
                <nav class="navbar navbar-expand-lg navbar-light p-0">
                    <div class="iq-navbar-logo d-flex align-items-center justify-content-between">
                        <i class="las la-bars wrapper-menu"></i>
                        <a href="/dashboard" class="header-logo">
                            <h5 class="logo-title ml-3">üçΩÔ∏è Las Gambusinas</h5>
                        </a>
                    </div>
                    
                    <!-- B√∫squeda Global -->
                    <div class="iq-search-bar device-search">
                        <form action="#" class="searchbox" id="searchForm">
                            <a class="search-link" href="#" onclick="event.preventDefault(); document.getElementById('searchInput').focus();">
                                <i class="las la-search"></i>
                            </a>
                            <input type="text" class="text search-input" id="searchInput" placeholder="Buscar mesas, platos, clientes...">
                            <div class="search-results" id="searchResults"></div>
                        </form>
                    </div>
                    
                    <div class="d-flex align-items-center">
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-label="Toggle navigation">
                            <i class="las la-bars"></i>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav ml-auto navbar-list align-items-center">
                                
                                <!-- Estado Caja -->
                                <li class="nav-item nav-icon">
                                    <a href="#" class="caja-status-badge caja-abierta" id="cajaStatus" onclick="event.preventDefault(); mostrarModalCaja();">
                                        <span id="cajaStatusText"><i class="las la-cash-register"></i> Abierta S/. 0.00</span>
                                    </a>
                                </li>
                                
                                <!-- Alertas Urgentes -->
                                <li class="nav-item nav-icon">
                                    <a href="#" class="alertas-urgentes-badge" id="alertasUrgentes" onclick="event.preventDefault(); mostrarAlertasUrgentes();">
                                        <i class="las la-exclamation-triangle"></i>
                                        <span class="badge-count" id="alertasCount">0</span>
                                    </a>
                                </li>
                                
                                <!-- Notificaciones -->
                                <li class="nav-item nav-icon dropdown">
                                    <a href="#" class="search-toggle dropdown-toggle" id="dropdownNotifications"
                                        onclick="event.preventDefault(); toggleDropdown('notificaciones');" aria-haspopup="true" aria-expanded="false">
                                        <i class="las la-bell"></i>
                                        <span class="bg-primary badge-notification" id="notificacionesBadge">0</span>
                                    </a>
                                    <div class="iq-sub-dropdown dropdown-menu dropdown-menu-right" aria-labelledby="dropdownNotifications">
                                        <div class="card shadow-none m-0">
                                            <div class="card-body p-0">
                                                <div class="cust-title p-3">
                                                    <div class="d-flex align-items-center justify-content-between">
                                                        <h5 class="mb-0">Notificaciones</h5>
                                                        <a class="badge badge-primary badge-card" href="#" id="notificacionesCount">0</a>
                                                    </div>
                                                </div>
                                                <div class="px-3 pt-0 pb-0 sub-card" id="notificacionesList">
                                                    <div class="text-center p-3">
                                                        <i class="las la-spinner la-spin"></i> Cargando...
                                                    </div>
                                                </div>
                                                <a class="right-ic btn btn-primary btn-block position-relative p-2" href="#" role="button" onclick="marcarTodasLeidas();">
                                                    Marcar todas como le√≠das
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                
                                <!-- Mensajes -->
                                <li class="nav-item nav-icon dropdown">
                                    <a href="#" class="search-toggle dropdown-toggle" id="dropdownMessages"
                                        onclick="event.preventDefault(); toggleDropdown('mensajes');" aria-haspopup="true" aria-expanded="false">
                                        <i class="las la-envelope"></i>
                                        <span class="bg-primary badge-notification" id="mensajesBadge">0</span>
                                    </a>
                                    <div class="iq-sub-dropdown dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMessages">
                                        <div class="card shadow-none m-0">
                                            <div class="card-body p-0">
                                                <div class="cust-title p-3">
                                                    <div class="d-flex align-items-center justify-content-between">
                                                        <h5 class="mb-0">Mensajes</h5>
                                                        <a class="badge badge-primary badge-card" href="#" id="mensajesCount">0</a>
                                                    </div>
                                                </div>
                                                <div class="px-3 pt-0 pb-0 sub-card" id="mensajesList">
                                                    <div class="text-center p-3">
                                                        <i class="las la-spinner la-spin"></i> Cargando...
                                                    </div>
                                                </div>
                                                <a class="right-ic btn btn-primary btn-block position-relative p-2" href="#" role="button">
                                                    Ver todos los mensajes
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                
                                <!-- Modo Oscuro/Claro -->
                                <li class="nav-item nav-icon">
                                    <a href="#" class="modo-toggle" id="modoToggle" onclick="event.preventDefault(); toggleModo();" title="Cambiar tema">
                                        <i class="las la-moon" id="modoIcon"></i>
                                    </a>
                                </li>
                                
                                <!-- Usuario -->
                                <li class="nav-item nav-icon dropdown caption-content">
                                    <a href="#" class="search-toggle dropdown-toggle" id="dropdownUser"
                                        onclick="event.preventDefault(); toggleDropdown('usuario');" aria-haspopup="true" aria-expanded="false">
                                        <img src="/dashboard/assets/images/user/1.jpg" class="img-fluid rounded" alt="user" id="userAvatar" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22%3E%3Ccircle cx=%2220%22 cy=%2220%22 r=%2218%22 fill=%22%23d4af37%22/%3E%3Ctext x=%2220%22 y=%2225%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2216%22 font-weight=%22bold%22%3EA%3C/text%3E%3C/svg%3E'">
                                    </a>
                                    <div class="iq-sub-dropdown dropdown-menu dropdown-menu-right" aria-labelledby="dropdownUser">
                                        <div class="card shadow-none m-0">
                                            <div class="card-body p-0 text-center">
                                                <div class="media-body profile-detail text-center">
                                                    <img src="/dashboard/assets/images/user/1.jpg" alt="profile-img"
                                                        class="rounded profile-img img-fluid avatar-70 mb-2">
                                                </div>
                                                <div class="p-3">
                                                    <h5 class="mb-1" id="userName">Admin</h5>
                                                    <p class="mb-0" id="userRole">Gerente</p>
                                                    <div class="d-flex align-items-center justify-content-center mt-3">
                                                        <a href="#" class="btn border mr-2 logout-btn" onclick="event.preventDefault(); mostrarPerfil();">Perfil</a>
                                                        <a href="#" class="btn border logout-btn" onclick="event.preventDefault(); if(typeof logout === 'function') { logout(); } else { localStorage.removeItem('adminToken'); window.location.href='/dashboard/login.html'; }">Salir</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
        <!-- Top Navbar END -->
        
        <!-- Main Content -->
        <div class="content-page">
            <div class="container-fluid">
                <!-- Page Header -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="iq-card iq-card-block iq-card-stretch iq-card-height">
                            <div class="iq-card-header d-flex justify-content-between align-items-center">
                                <div class="iq-header-title">
                                    <h4 class="card-title">Dashboard Principal</h4>
                                    <p class="text-muted mb-0">Vista general del restaurante en tiempo real</p>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <button class="btn btn-sm btn-outline-gold" onclick="refreshDashboard()" title="Actualizar todos los datos">
                                        <i class="las la-sync"></i> Actualizar
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger logout-btn" onclick="if(typeof logout === 'function') { logout(); } else { localStorage.removeItem('adminToken'); window.location.href='/dashboard/login.html'; }" title="Cerrar sesi√≥n">
                                        <i class="las la-sign-out-alt"></i> Salir
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 5 Cards Principales -->
                <div class="row">
                    <!-- Card 1: Mesas Real-Time -->
                    <div class="col-lg-4 col-md-6">
                        <div class="iq-card iq-card-block iq-card-stretch iq-card-height premium-card">
                            <div class="iq-card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h6 class="card-title text-uppercase text-muted mb-2">Mesas Ocupadas</h6>
                                        <h2 class="counter mb-0" data-target="12">0</h2>
                                        <p class="text-muted mb-0">de <span id="total-mesas">20</span> mesas</p>
                                    </div>
                                    <div class="icon-box icon-box-premium">
                                        <i class="las la-clipboard-list"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="progress progress-premium" style="height: 8px;">
                                        <div class="progress-bar progress-bar-premium" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small class="text-muted mt-2 d-block">60% ocupaci√≥n</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card 2: Ventas Hoy -->
                    <div class="col-lg-4 col-md-6">
                        <div class="iq-card iq-card-block iq-card-stretch iq-card-height premium-card">
                            <div class="iq-card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h6 class="card-title text-uppercase text-muted mb-2">Ventas Hoy</h6>
                                        <h2 class="counter mb-0" data-target="2450">0</h2>
                                        <p class="text-muted mb-0">S/. <span class="counter" data-target="2450">0</span> | <span id="tickets-hoy">47</span> tickets</p>
                                    </div>
                                    <div class="icon-box icon-box-premium icon-box-sales">
                                        <i class="las la-chart-line"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="badge badge-success badge-premium">+12% vs ayer</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card 3: Top Platos -->
                    <div class="col-lg-4 col-md-6">
                        <div class="iq-card iq-card-block iq-card-stretch iq-card-height premium-card">
                            <div class="iq-card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h6 class="card-title text-uppercase text-muted mb-2">Top Platos</h6>
                                        <h5 class="mb-1">Ceviche</h5>
                                        <p class="text-muted mb-0"><span class="counter" data-target="12">0</span> unidades</p>
                                        <small class="text-muted">Paella: <span class="counter" data-target="8">0</span> und</small>
                                    </div>
                                    <div class="icon-box icon-box-premium icon-box-platos">
                                        <i class="las la-utensils"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card 4: Mozos -->
                    <div class="col-lg-4 col-md-6">
                        <div class="iq-card iq-card-block iq-card-stretch iq-card-height premium-card">
                            <div class="iq-card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h6 class="card-title text-uppercase text-muted mb-2">Top Mozos</h6>
                                        <h5 class="mb-1">Juan</h5>
                                        <p class="text-muted mb-0">S/. <span class="counter" data-target="980">0</span> | <span id="mesas-mozo-1">18</span> mesas</p>
                                        <small class="text-muted">Mar√≠a: S/. <span class="counter" data-target="720">0</span></small>
                                    </div>
                                    <div class="icon-box icon-box-premium icon-box-mozos">
                                        <i class="las la-user-tie"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card 5: Alertas -->
                    <div class="col-lg-4 col-md-6">
                        <div class="iq-card iq-card-block iq-card-stretch iq-card-height premium-card">
                            <div class="iq-card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h6 class="card-title text-uppercase text-muted mb-2">Alertas</h6>
                                        <h5 class="mb-1"><span id="alertas-count">2</span> pendientes</h5>
                                        <p class="text-muted mb-0">Mesas pagadas pendientes</p>
                                        <small class="text-success">Cierre caja listo</small>
                                    </div>
                                    <div class="icon-box icon-box-premium icon-box-alertas">
                                        <i class="las la-bell"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal -->
    <div id="modal" class="modal-premium">
        <div class="modal-content-premium">
            <div class="modal-header-premium">
                <h5 id="modal-title">Modal</h5>
                <span class="close-modal" onclick="closeModal()">&times;</span>
            </div>
            <div id="modal-body" class="modal-body-premium"></div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/waypoints@4.0.1/lib/noframework.waypoints.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/counterup2@2.0.2/dist/index.js"></script>
    <script src="/dashboard/assets/js/admin-functions.js"></script>
    <script src="/dashboard/assets/js/header.js"></script>
    <script src="/dashboard/assets/js/dashboard.js"></script>
</body>
</html>


